require=function e(t,n,i){function s(o,a){if(!n[o]){if(!t[o]){var r="function"==typeof require&&require;if(!a&&r)return r(o,!0);if(c)return c(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,i)}return n[o].exports}for(var c="function"==typeof require&&require,o=0;o<i.length;o++)s(i[o]);return s}({AllEffect:[function(e,t,n){"use strict";cc._RF.push(t,"cd0bb+S4MRA25vYojVfC+67","AllEffect");var i=e("../core/MessagePipeline");cc.Class({extends:cc.Component,properties:{effectColor:cc.Node},onLoad:function(){},allEffect:function(e){var t=e.action;"clear"===t?this._clear():"blackOut"===t?this._blackOut(e.time):"blackIn"===t&&this._blackIn(e.time)},_clear:function(){this.effectColor.opacity=0,i.messagePipeline.sendMessage("onNextScript")},_blackOut:function(e){var t=cc.fadeIn(e),n=cc.callFunc(function(){i.messagePipeline.sendMessage("onNextScript")},this);this.effectColor.color=cc.Color.BLACK,this.effectColor.runAction(cc.sequence(t,n))},_blackIn:function(e){var t=cc.fadeOut(e),n=cc.callFunc(function(){i.messagePipeline.sendMessage("onNextScript")},this);this.effectColor.color=cc.Color.BLACK,this.effectColor.runAction(cc.sequence(t,n))}}),cc._RF.pop()},{"../core/MessagePipeline":"MessagePipeline"}],Background:[function(e,t,n){"use strict";cc._RF.push(t,"1734fG/YEtLFZSCBTtMmPgp","Background");var i=e("../core/MessagePipeline"),s=cc.sequence(cc.moveTo(0,-4,-4),cc.delayTime(.05),cc.moveTo(0,4,-4),cc.delayTime(.05),cc.moveTo(0,4,4),cc.delayTime(.05),cc.moveTo(0,-4,4),cc.delayTime(.05),cc.moveTo(0,0,0));cc.Class({extends:cc.Component,properties:{bgImages:{default:[],type:[cc.SpriteFrame]},bgBack:cc.Sprite,bgFront:cc.Sprite,effectColor:cc.Node},onLoad:function(){},bgEffect:function(e){var t=e.action;"change"===t?this._bgChange(e.bgIndex):"fadein"===t?this._bgFadeIn(e.bgIndex,e.time):"fadeout"===t?this._bgFadeOut(e.color,e.time):"crossfade"===t?this._bgCrossFade(1,1):"open"===t?this._bgOpen(4,0,0,1):"flash"===t?this._bgFlash(5,.1,cc.color(255,255,0)):"shake"===t?this._bgShake(5):"clear"===t&&this._bgClear()},_bgClear:function(){this.bgFront.spriteFrame=this.bgImages[0],this.effectColor.opacity=0,i.messagePipeline.sendMessage("onNextScript")},_bgChange:function(e){this.bgFront.spriteFrame=this.bgImages[e],i.messagePipeline.sendMessage("onNextScript")},_bgFadeIn:function(e,t){this.bgFront.spriteFrame=this.bgImages[e];var n=cc.fadeOut(t),s=cc.callFunc(function(){i.messagePipeline.sendMessage("onNextScript")},this);this.effectColor.runAction(cc.sequence(n,s))},_bgFadeOut:function(e,t){this.effectColor.color=cc.hexToColor(e);var n=cc.fadeIn(t),s=cc.callFunc(function(){i.messagePipeline.sendMessage("onNextScript")},this);this.effectColor.runAction(cc.sequence(n,s))},_bgCrossFade:function(e,t){var n=this;this.bgBack.node.active=!0,this.bgBack.spriteFrame=this.bgImages[e];var s=cc.fadeIn(t),c=cc.callFunc(function(){n.bgBack.node.active=!1},this);this.bgBack.node.runAction(cc.sequence(s,c));var o=cc.fadeOut(t),a=cc.callFunc(function(){n.bgFront.node.opacity=255,n.bgFront.spriteFrame=n.bgImages[e],i.messagePipeline.sendMessage("onNextScript")},this);this.bgFront.node.runAction(cc.sequence(o,a))},_bgOpen:function(e,t,n,s){this.bgFront.spriteFrame=this.bgImages[e],this.bgFront.node.setScale(t,n);var c=cc.scaleTo(s,1,1),o=cc.callFunc(function(){i.messagePipeline.sendMessage("onNextScript")},this);this.bgFront.node.runAction(cc.sequence(c,o))},_bgFlash:function(e,t,n){this.effectColor.color=n;var s=cc.fadeIn(0),c=cc.delayTime(t),o=cc.fadeOut(0),a=cc.sequence(s,cc.delayTime(.05),o,c),r=cc.callFunc(function(){i.messagePipeline.sendMessage("onNextScript")},this);this.effectColor.runAction(cc.sequence(cc.repeat(a,e),r))},_bgShake:function(e){var t=cc.callFunc(function(){i.messagePipeline.sendMessage("onNextScript")},this);this.node.runAction(cc.sequence(cc.repeat(s,e),t))}}),cc._RF.pop()},{"../core/MessagePipeline":"MessagePipeline"}],Characters:[function(e,t,n){"use strict";cc._RF.push(t,"2f3a6oI01pJ8qQvjT9SP6rm","Characters");var i=e("../core/MessagePipeline");cc.Class({extends:cc.Component,properties:{characters:{default:[],type:[cc.Node]}},onLoad:function(){i.messagePipeline.on("onCheckMenuOpen",this._charaHideForTemp,this),i.messagePipeline.on("onCheckMenuClose",this._charaShowFromTemp,this)},charaEffect:function(e){var t=e.action;"reset"===t?this._charaReset():"show"===t?this._charaShow(e.data):"hide"===t&&this._charaHide(e.data)},_charaReset:function(){for(var e=0;e<this.characters.length;e++)this.characters[e].setScale(0);i.messagePipeline.sendMessage("onNextScript")},_charaShow:function(e){for(var t=e.concat(),n=[],s=640/(t.length+1),c=0;c<t.length;c++)t[c].time||(t[c].time=0),t[c].opacity||(t[c].opacity=127),t[c].x||0===t[c].x||(t[c].x=s*(c+1)-320),t[c].y||0===t[c].y||(t[c].y=-90),t[c].sx||(t[c].sx=1),t[c].sy||(t[c].sy=1),this.characters[t[c].index].setScale(t[c].sx,t[c].sy),this.characters[t[c].index].x=t[c].x,this.characters[t[c].index].y=t[c].y,this.characters[t[c].index].opacity=0,n.push(this._fadePromise(t[c].index,t[c].time,t[c].opacity));Promise.all(n).then(function(){i.messagePipeline.sendMessage("onNextScript")})},_charaHide:function(e){for(var t=e.concat(),n=[],s=0;s<t.length;s++)n.push(this._fadePromise(t[s].index,t[s].time,0));Promise.all(n).then(function(){i.messagePipeline.sendMessage("onNextScript")})},_fadePromise:function(e,t,n){var i=this;return new Promise(function(s,c){var o=cc.fadeTo(t,n),a=cc.callFunc(function(){s(i)},i);i.characters[e].runAction(cc.sequence(o,a))})},_charaHideForTemp:function(){var e=cc.fadeOut(.5);this.node.runAction(e)},_charaShowFromTemp:function(){var e=cc.fadeIn(.5);this.node.runAction(e)}}),cc._RF.pop()},{"../core/MessagePipeline":"MessagePipeline"}],CheckItem:[function(e,t,n){"use strict";cc._RF.push(t,"4fe305uyDpCzLJAJXtpbUFs","CheckItem"),cc.Class({extends:cc.Component,properties:{itemSprite:cc.Sprite},onLoad:function(){this._debugSprite=this.node.getComponent(cc.Sprite),this._touchInput=this.node.getComponent("TouchInput")},init:function(e){this.node.opacity=255,this._debugSprite.spriteFrame="",this._touchInput.eventType=""},itemClear:function(){this.itemSprite.spriteFrame=null}}),cc._RF.pop()},{}],CheckMenu:[function(e,t,n){"use strict";cc._RF.push(t,"84d8bvhhoVICJ/KmVOkw++I","CheckMenu");var i=e("../../core/MessagePipeline"),s=function(e){return e&&e.__esModule?e:{default:e}}(e("../NovelCore"));cc.Class({extends:cc.Component,properties:{checkZones:{default:[],type:[cc.Node]}},onLoad:function(){this.node.x=2e3,this.isChecking=!1,i.messagePipeline.on("onCheckTouch",this._onCheckTouch,this),i.messagePipeline.on("onCheckMenuOpen",this._onCheckMenuOpen,this)},createButton:function(e,t){},checkEnd:function(){this.isChecking=!1},_onCheckMenuOpen:function(){for(var e=s.default.instance.getScene(),t=0;t<this.checkZones.length;t++)t===e.checkZoneIndex?this.checkZones[t].scaleY=1:this.checkZones[t].scaleY=0},_onCheckTouch:function(e){var t=e.detail;if(this.isChecking)i.messagePipeline.sendMessage("onTouch","text");else{this.isChecking=!0;e.detail;i.messagePipeline.sendMessage("onCheckStart",t)}}}),cc._RF.pop()},{"../../core/MessagePipeline":"MessagePipeline","../NovelCore":"NovelCore"}],ChoiceButton:[function(e,t,n){"use strict";cc._RF.push(t,"e6a4bynq9ZJQIZOhUz+5Vng","ChoiceButton");var i=e("../../core/MessagePipeline");cc.Class({extends:cc.Component,properties:{btnLabel:cc.Label},onLoad:function(){this.id=""},init:function(e,t){this.id=e,this.btnLabel.string=t,this.node.x=0},$clicked:function(){i.messagePipeline.sendMessage("onChoiceClicked",this.id)}}),cc._RF.pop()},{"../../core/MessagePipeline":"MessagePipeline"}],ChoiceMenu:[function(e,t,n){"use strict";cc._RF.push(t,"281b0lcaCBMJKD+axAXr/qg","ChoiceMenu"),cc.Class({extends:cc.Component,properties:{choiceContentsNode:cc.Node,choiceButtonPrefab:cc.Prefab},onLoad:function(){},clear:function(){this.choiceContentsNode.removeAllChildren()},createButton:function(e,t){var n=cc.instantiate(this.choiceButtonPrefab);n.parent=this.choiceContentsNode,n.getComponent("ChoiceButton").init(e,t)}}),cc._RF.pop()},{}],DisplayStats:[function(e,t,n){"use strict";cc._RF.push(t,"1ce9fzAG6xGyYH0BRFc+0FA","DisplayStats"),cc.Class({extends:cc.Component,properties:{displayStats:!0},onLoad:function(){cc.director.setDisplayStats(this.displayStats)}}),cc._RF.pop()},{}],ItemButton:[function(e,t,n){"use strict";cc._RF.push(t,"3a62186BRxL24++ilH/Xnh3","ItemButton");var i=e("../../core/MessagePipeline");cc.Class({extends:cc.Component,properties:{btnSprite:cc.Sprite,btnOn:cc.Node},onLoad:function(){this.data=null,i.messagePipeline.on("onItemClicked",this._onItemClicked,this),i.messagePipeline.on("onItemMenuOpen",this._onItemClicked,this)},init:function(e,t){this.data=e,this.btnSprite.spriteFrame=t},$clicked:function(){i.messagePipeline.sendMessage("onItemClicked",this.data),this.btnOn.active=!0},_onItemClicked:function(){this.btnOn.active=!1}}),cc._RF.pop()},{"../../core/MessagePipeline":"MessagePipeline"}],ItemMenu:[function(e,t,n){"use strict";cc._RF.push(t,"58d3bwKkHdNeo2nQBpS1QcJ","ItemMenu");var i=e("../../core/MessagePipeline");cc.Class({extends:cc.Component,properties:{itemContentsNode:cc.Node,itemButtonPrefab:cc.Prefab,itemName:cc.Label,itemDescription:cc.Label,itemIcons:{default:[],type:[cc.SpriteFrame]}},onLoad:function(){this.node.x=2e3,this.selectedItem="",i.messagePipeline.on("onItemClicked",this._onItemClicked,this)},clear:function(){this.textClear(),this.itemContentsNode.removeAllChildren()},textClear:function(){this.selectedItem="",this.itemName.string="",this.itemDescription.string=""},createButton:function(e){var t=cc.instantiate(this.itemButtonPrefab);t.parent=this.itemContentsNode,t.getComponent("ItemButton").init(e,this.itemIcons[e.imageIndex])},_onItemClicked:function(e){var t=e.detail;this.selectedItem=t.id,this.itemName.string=t.name,this.itemDescription.string=t.description},$onClickUseButton:function(){""!==this.selectedItem&&i.messagePipeline.sendMessage("onItemStart",this.selectedItem)}}),cc._RF.pop()},{"../../core/MessagePipeline":"MessagePipeline"}],MainMenu:[function(e,t,n){"use strict";cc._RF.push(t,"e51aakDNnlOlLoiHdvU1D72","MainMenu");var i=e("../../core/MessagePipeline");cc.Class({extends:cc.Component,properties:{textNode:cc.Node,talkMenu:cc.Node,itemMenu:cc.Node,checkMenu:cc.Node,moveMenu:cc.Node},onLoad:function(){i.messagePipeline.on("onTalkStart",this.$onClickTalkBackButton,this),i.messagePipeline.on("onItemStart",this.$onClickItemBackButton,this),i.messagePipeline.on("onMoveStart",this.$onClickMoveBackButton,this)},$onClickTalkButton:function(){this.node.x=2e3,this.talkMenu.x=0},$onClickTalkBackButton:function(){this.node.x=0,this.talkMenu.x=2e3},$onClickItemButton:function(){this.node.x=2e3,this.textNode.opacity=0,this.itemMenu.x=0},$onClickItemBackButton:function(){this.node.x=0,this.textNode.opacity=255,this.itemMenu.getComponent("ItemMenu").textClear(),i.messagePipeline.sendMessage("onItemMenuOpen"),this.itemMenu.x=2e3},$onClickCheckButton:function(){this.node.x=2e3,this.checkMenu.x=0,i.messagePipeline.sendMessage("onCheckMenuOpen")},$onClickCheckBackButton:function(){this.node.x=0,this.checkMenu.x=2e3,i.messagePipeline.sendMessage("onCheckMenuClose")},$onClickMoveButton:function(){this.node.x=2e3,this.moveMenu.x=0},$onClickMoveBackButton:function(){this.node.x=0,this.moveMenu.x=2e3}}),cc._RF.pop()},{"../../core/MessagePipeline":"MessagePipeline"}],MessagePipeline:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}cc._RF.push(t,"45b91KVxpJMsIZ5xB5qvBH5","MessagePipeline"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(e){function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,cc.EventTarget),o(t,[{key:"sendMessage",value:function(e,t){this.emit(e,t)}}]),t}();n.messagePipeline=new a;cc._RF.pop()},{}],Mochi:[function(e,t,n){"use strict";cc._RF.push(t,"c8b96VRd6FDm5LsyllTzY43","Mochi"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.targetX=this.node.position.x},update:function(e){var t=this.targetX-this.node.x;this.node.x+=t*(2*e)},setTarget:function(e){this.targetX=e}}),cc._RF.pop()},{}],MoveButton:[function(e,t,n){"use strict";cc._RF.push(t,"240b8X9d0ROxohTg4gQyMdy","MoveButton");var i=e("../../core/MessagePipeline");cc.Class({extends:cc.Component,properties:{btnLabel:cc.Label},onLoad:function(){this.id=""},init:function(e,t){this.id=e,this.btnLabel.string=t},$clicked:function(){i.messagePipeline.sendMessage("onMoveStart",this.id)}}),cc._RF.pop()},{"../../core/MessagePipeline":"MessagePipeline"}],MoveMenu:[function(e,t,n){"use strict";cc._RF.push(t,"f79d4CpGplMvrGJj0OqMsZk","MoveMenu"),cc.Class({extends:cc.Component,properties:{moveContentsNode:cc.Node,moveButtonPrefab:cc.Prefab},onLoad:function(){this.node.x=2e3},clear:function(){this.moveContentsNode.removeAllChildren()},createButton:function(e,t){var n=cc.instantiate(this.moveButtonPrefab);n.parent=this.moveContentsNode,n.getComponent("MoveButton").init(e,t)}}),cc._RF.pop()},{}],NovelCore:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}cc._RF.push(t,"a1b31dtGC5PQLGrH+So461W","NovelCore"),Object.defineProperty(n,"__esModule",{value:!0});var s=e("../core/MessagePipeline"),c=i(e("./AllEffect")),o=i(e("./Background")),a=i(e("./Characters")),r=i(e("./Texts")),h=i(e("./talk/TalkMenu")),l=i(e("./move/MoveMenu")),u=i(e("./check/CheckMenu")),p=i(e("./choice/ChoiceMenu")),d=i(e("./item/ItemMenu")),f=[{type:"common",action:"start"},{type:"text",action:"clear"},{type:"allEffect",action:"blackOut",time:1},{type:"bg",action:"clear"},{type:"chara",action:"reset"}],m=[{type:"common",action:"start"},{type:"text",action:"disp",data:{name:"",auto:1,text:"特に何も起きない"}},{type:"common",action:"end"}],g=[{type:"common",action:"start"},{type:"text",action:"disp",data:{name:"",auto:1,text:"特に気になるところはない"}},{type:"common",action:"checkEnd"},{type:"common",action:"end"}],_=cc.Class({extends:cc.Component,properties:{mainScreen:cc.Node,sceneNameText:cc.Label,allEffect:c.default,background:o.default,characters:a.default,texts:r.default,menuBlocker:cc.Node,firstSceneId:"introduction",talkMenu:h.default,moveMenu:l.default,choiceMenu:p.default,itemMenu:d.default,checkMenu:u.default},statics:{instance:null},onLoad:function(){_.instance=this,s.messagePipeline.on("onNextScript",this._onNextScript,this),s.messagePipeline.on("onTalkStart",this._onTalkStart,this),s.messagePipeline.on("onItemStart",this._onItemStart,this),s.messagePipeline.on("onCheckStart",this._onCheckStart,this),s.messagePipeline.on("onMoveStart",this._onMoveStart,this),s.messagePipeline.on("onChoiceClicked",this._onChoiceClicked,this),this.init()},getScene:function(){return this._scene},init:function(){var e=this;this.menuBlocker.setScale(1),this._scriptLineNo=-1,this._flags=[],this._scenes=[],this._scripts=[],this._flags=[],this._itemsData=[],this._items=[];var t=new Promise(function(t,n){cc.loader.loadRes("jsons/scenes",function(i,s){if(i)n(i);else{for(var c=0;c<s.length;c++)e._scenes[s[c].id]=s[c];t(e)}})}),n=new Promise(function(t,n){cc.loader.loadRes("jsons/scripts",function(i,s){if(i)n(i);else{for(var c=0;c<s.length;c++)e._scripts[s[c].id]=s[c];t(e)}})}),i=new Promise(function(t,n){cc.loader.loadRes("jsons/items",function(i,s){if(i)n(i);else{for(var c=0;c<s.length;c++)e._itemsData[s[c].id]=s[c];t(e)}})});Promise.all([t,n,i]).then(function(){e._changeScene(e.firstSceneId)}).catch(function(e){cc.error(e)})},_changeScene:function(e){this._scene=this._scenes[e],this._script=this._scripts[this._scene.firstScript].script.concat(),this._scriptLineNo=-1,this.sceneNameText.string=this._scene.name,this.talkMenu.clear(),this._scene.talks.forEach(function(e){this.talkMenu.createButton(e,this._scripts[e].name)},this),this.moveMenu.clear(),this._scene.moves.forEach(function(e){this.moveMenu.createButton(e,this._scenes[e].name)},this),this._onNextScript()},_onTalkStart:function(e){var t=e.detail;this._script=this._scripts[t].script,this._scriptLineNo=-1,this._onNextScript()},_onItemStart:function(e){var t="item:"+e.detail+":"+this._scene.id;this._scripts[t]?this._script=this._scripts[t].script.concat():this._script=m.concat(),this._scriptLineNo=-1,this._onNextScript()},_onCheckStart:function(e){var t=e.detail;this._scripts[t]?this._script=this._scripts[t].script.concat():this._script=g.concat(),this._scriptLineNo=-1,this._onNextScript()},_onMoveStart:function(e){var t=e.detail;this._script=f.concat(),this.sceneNameText.string="",this._script.push({type:"common",action:"sceneChange",sceneId:t}),this._scriptLineNo=-1,this._onNextScript()},_onChoiceClicked:function(e){var t=e.detail,n=this._scripts[t];if(n&&n.script)for(var i=0;i<n.script.length;i++)this._script.splice(this._scriptLineNo+i+1,0,n.script[i]);this.choiceMenu.clear(),s.messagePipeline.sendMessage("onNextScript")},_onNextScript:function(){if(this._scriptLineNo+=1,!(this._scriptLineNo>=this._script.length)){var e=this._script[this._scriptLineNo];"bg"===e.type?this.background.bgEffect(e):"chara"===e.type?this.characters.charaEffect(e):"text"===e.type?this.texts.textEffect(e):"common"===e.type?this._commonEvent(e):"allEffect"===e.type&&this.allEffect.allEffect(e)}},_commonEvent:function(e){var t=e.action;"start"===t?this._commonStart():"wait"===t?this._commonWait(e.time):"end"===t?this._commonEnd():"sceneChange"===t?this._commonSceneChange(e):"addTalk"===t?this._commonAddTalk(e):"delTalk"===t?this._commonDelTalk(e):"delAllTalk"===t?this._commonDelAllTalk(e):"flagOn"===t?this._commonFlagOn(e):"if-flag-start"===t?this._commonIfFlag(e):"if-flag-end"===t?this._commonIfFlagEnd(e):"chioce"===t?this._commonChoice(e):"choice-start"===t?this._commonChoiceStart(e):"choice-end"===t?this._commonChoiceEnd(e):"itemAdd"===t?this._commonItemAdd(e):"checkEnd"===t&&this._commonCheckEnd(e)},_commonStart:function(){this.menuBlocker.setScale(1),s.messagePipeline.sendMessage("onNextScript")},_commonWait:function(e){var t=cc.delayTime(e),n=cc.callFunc(function(){s.messagePipeline.sendMessage("onNextScript")},this);this.node.runAction(cc.sequence(t,n))},_commonSceneChange:function(e){this._changeScene(e.sceneId)},_commonEnd:function(){this.menuBlocker.setScale(0);for(var e=!1,t=0;t<this._script.length;t++)"common"===this._script[t].type&&"choice-start"===this._script[t].action?e=!0:"common"===this._script[t].type&&"choice-end"===this._script[t].action&&(e=!1),e&&(this._script.splice(t,1),t-=1);s.messagePipeline.sendMessage("onNextScript")},_commonAddTalk:function(e){this._scene.talks.indexOf(e.id)<0&&(this._scene.talks.push(e.id),this.talkMenu.createButton(e.id,this._scripts[e.id].name)),s.messagePipeline.sendMessage("onNextScript")},_commonDelTalk:function(e){var t=this._scene.talks.indexOf(e.id);t>=0&&this._scene.talks.splice(t,1),this.talkMenu.removeButton(e.id),s.messagePipeline.sendMessage("onNextScript")},_commonDelAllTalk:function(e){this._scene.talks=[],this.talkMenu.clear(),s.messagePipeline.sendMessage("onNextScript")},_commonFlagOn:function(e){this._flags.indexOf(e.id)<0&&this._flags.push(e.id),s.messagePipeline.sendMessage("onNextScript")},_commonIfFlag:function(e){if(e.val&&this._flags.indexOf(e.id)<0||!e.val&&this._flags.indexOf(e.id)>=0){for(var t=e.flagKey,n=this._scriptLineNo;n<this._script.length;n++)if("common"===this._script[n].type&&"if-flag-end"===this._script[n].action&&this._script[n].flagKey===t)return this._scriptLineNo=n,void s.messagePipeline.sendMessage("onNextScript")}else s.messagePipeline.sendMessage("onNextScript")},_commonIfFlagEnd:function(e){s.messagePipeline.sendMessage("onNextScript")},_commonChoice:function(e){for(var t=0;t<e.data.length;t++)this.choiceMenu.createButton(e.data[t].id,e.data[t].label)},_commonChoiceStart:function(){s.messagePipeline.sendMessage("onNextScript")},_commonChoiceEnd:function(){s.messagePipeline.sendMessage("onNextScript")},_commonItemAdd:function(e){var t=e.id;if(this._items.indexOf(t)<0){this._items.push(t);var n=this._itemsData[t];this.itemMenu.createButton(n)}s.messagePipeline.sendMessage("onNextScript")},_commonCheckEnd:function(e){this.checkMenu.checkEnd(),setTimeout(function(){s.messagePipeline.sendMessage("onNextScript")})}});n.default=_,t.exports=n.default,cc._RF.pop()},{"../core/MessagePipeline":"MessagePipeline","./AllEffect":"AllEffect","./Background":"Background","./Characters":"Characters","./Texts":"Texts","./check/CheckMenu":"CheckMenu","./choice/ChoiceMenu":"ChoiceMenu","./item/ItemMenu":"ItemMenu","./move/MoveMenu":"MoveMenu","./talk/TalkMenu":"TalkMenu"}],TalkButton:[function(e,t,n){"use strict";cc._RF.push(t,"1c45f890Y1IcZru6lcPn3d3","TalkButton");var i=e("../../core/MessagePipeline");cc.Class({extends:cc.Component,properties:{btnLabel:cc.Label},onLoad:function(){this.id=""},init:function(e,t){this.id=e,this.btnLabel.string=t},$clicked:function(){i.messagePipeline.sendMessage("onTalkStart",this.id)}}),cc._RF.pop()},{"../../core/MessagePipeline":"MessagePipeline"}],TalkMenu:[function(e,t,n){"use strict";cc._RF.push(t,"e7f16aWRqFKFIEiIf2FOWa0","TalkMenu"),cc.Class({extends:cc.Component,properties:{talkContentsNode:cc.Node,talkButtonPrefab:cc.Prefab},onLoad:function(){this.node.x=2e3},clear:function(){this.talkContentsNode.removeAllChildren()},removeButton:function(e){this.talkContentsNode.getComponentsInChildren("TalkButton").forEach(function(t){t.id===e&&this.talkContentsNode.removeChild(t.node)},this)},createButton:function(e,t){var n=cc.instantiate(this.talkButtonPrefab);n.parent=this.talkContentsNode,n.getComponent("TalkButton").init(e,t)}}),cc._RF.pop()},{}],Texts:[function(e,t,n){"use strict";cc._RF.push(t,"694aa6p64ZMMaWa7fCv1+sC","Texts");var i=e("../core/MessagePipeline");cc.Class({extends:cc.Component,properties:{nameLabel:cc.Label,textLabel:cc.Label,letterPerSec:30},onLoad:function(){this.nameLabel.string="",this.textLabel.string="",this.dispText="",this.textDispLen=0,this.textTotalLen=0,this.isTextTyping=!1,this.isWaitingTouch=!1,this.isAuto=!1,i.messagePipeline.on("onTouch",this._onTouch,this)},textEffect:function(e){var t=e.action;"disp"===t?this._disp(e.data):"clear"===t&&this._clear()},_disp:function(e){this.nameLabel.string=e.name,this.textLabel.string="",this.dispText=e.text,e.speed?this.letterPerSec=e.speed:this.letterPerSec=30,this.textDispLen=0,this.textTotalLen=this.dispText.length,this.isTextTyping=!0,this.isAuto=1===e.auto},_clear:function(){this.nameLabel.string="",this.textLabel.string="",this.dispText="",this.textDispLen=0,this.textTotalLen=0,this.isTextTyping=!1,this.isWaitingTouch=!1,i.messagePipeline.sendMessage("onNextScript")},_onTouch:function(e){"text"===e.detail&&(this.isTextTyping?(this.textLabel.string=this.dispText,this.isTextTyping=!1,this.isWaitingTouch=!0,this.isAuto&&(this.isWaitingTouch=!1,i.messagePipeline.sendMessage("onNextScript"))):this.isWaitingTouch&&(this.isWaitingTouch=!1,i.messagePipeline.sendMessage("onNextScript")))},update:function(e){this.isTextTyping&&(this.textDispLen=Math.min(this.textTotalLen,this.textDispLen+e*this.letterPerSec),this.textLabel.string=this.dispText.substr(0,Math.floor(this.textDispLen)),this.textDispLen>=this.textTotalLen&&(this.isTextTyping=!1,this.isWaitingTouch=!0,this.isAuto&&(this.isWaitingTouch=!1,i.messagePipeline.sendMessage("onNextScript"))))}}),cc._RF.pop()},{"../core/MessagePipeline":"MessagePipeline"}],TouchInput:[function(e,t,n){"use strict";cc._RF.push(t,"ebbbaGZgelHMo+XOSruDJ7R","TouchInput");var i=e("../core/MessagePipeline");cc.Class({extends:cc.Component,properties:{eventType:""},onLoad:function(){this._registerEvent()},onDestroy:function(){this._unregisterEvent()},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this)},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this)},_onTouchBegan:function(e){e.getLocation();"text"===this.eventType?i.messagePipeline.sendMessage("onTouch",this.eventType):0===this.eventType.indexOf("check:")&&i.messagePipeline.sendMessage("onCheckTouch",this.eventType)}}),cc._RF.pop()},{"../core/MessagePipeline":"MessagePipeline"}]},{},["Mochi","DisplayStats","MessagePipeline","AllEffect","Background","Characters","NovelCore","Texts","TouchInput","CheckItem","CheckMenu","ChoiceButton","ChoiceMenu","ItemButton","ItemMenu","MainMenu","MoveButton","MoveMenu","TalkButton","TalkMenu"]);